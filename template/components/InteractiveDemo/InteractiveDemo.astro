---
import { DBButton, DBStack, DBCard } from '@db-ux/react-core-components';
import './InteractiveDemo.css';
import OptimizedImage from '../OptimizedImage/OptimizedImage.astro';

type InteractiveDemoItem = {
  id: string;
  label: string;
  icon?: string;
  color?: string;
  variant?: string;
  lightSrc: string;
  darkSrc: string;
  alt?: string;
};

interface Props {
  items: readonly InteractiveDemoItem[];
  initialId?: string;
}

const props = Astro.props as Props;
const items = Array.isArray(props.items) ? props.items : [];
const initialId = props.initialId;
const initialItem = (initialId && items.find((i) => i.id === initialId)) ?? items[0] ?? null;
const initialMode = 'light';
---

{
  items.length === 0 || !initialItem ? null : (
    <div class="interactive-demo" data-image-toggle-root data-active-id={initialItem.id}>
      {/* State carrier for the script (must NOT affect theming/layout) */}
      <span
        class="interactive-demo__state"
        data-image-toggle-state
        data-mode={initialMode}
        hidden
      />

      <DBStack direction="column" gap="medium" class="interactive-demo__layout">
        <div class="interactive-demo__controls">
          <DBStack direction="row" gap="2x-small" justifyContent="center">
            <DBStack direction="row" gap="2x-small" justifyContent="center">
              {items.map((item) => (
                <DBButton
                  type="button"
                  icon={item.icon}
                  variant={item.variant}
                  data-color={item.color}
                  data-image-toggle-button
                  data-image-id={item.id}
                  {...(item.id === initialItem.id ? { 'data-active': 'true' } : {})}
                >
                  {item.label}
                </DBButton>
              ))}
            </DBStack>

            {/* Initial state: light is active -> show only "switch to dark" (moon) */}
            <DBButton
              type="button"
              icon="moon"
              variant="ghost"
              noText={true}
              data-image-toggle-to="dark"
              aria-label="Switch to dark mode"
              style={{ display: 'inline-flex' }}
            />
            <DBButton
              type="button"
              icon="sun"
              variant="ghost"
              noText={true}
              data-image-toggle-to="light"
              aria-label="Switch to light mode"
              style={{ display: 'none' }}
            />
          </DBStack>
        </div>

        <div class="interactive-demo__cards">
          {items.map((item) => (
            <>
              <div
                class="interactive-demo__card"
                data-image-card
                data-image-id={item.id}
                data-image-mode="light"
                {...(item.id === initialItem.id ? { 'data-active': 'true' } : {})}
              >
                <DBCard spacing="none" class="interactive-demo__card-inner">
                  <OptimizedImage
                    class="interactive-demo__img"
                    src={item.lightSrc}
                    alt={item.alt ?? item.label}
                    loading="lazy"
                    decoding="async"
                  />
                </DBCard>
              </div>

              <div
                class="interactive-demo__card"
                data-image-card
                data-image-id={item.id}
                data-image-mode="dark"
              >
                <DBCard spacing="none" class="interactive-demo__card-inner">
                  <OptimizedImage
                    class="interactive-demo__img"
                    src={item.darkSrc}
                    alt={item.alt ?? item.label}
                    loading="lazy"
                    decoding="async"
                  />
                </DBCard>
              </div>
            </>
          ))}
        </div>
      </DBStack>

      <script
        is:inline
        src={`${import.meta.env.BASE_URL}assets/interactive-demo/interactiveDemo.client.js`}
      />
    </div>
  )
}
