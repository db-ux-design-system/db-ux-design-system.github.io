---
import './ComponentPlayground.css';

interface Props {
	config: any;
	component: any;
}

const { config, component: Component } = Astro.props;

// Native HTML attributes that should not use data- prefix
const nativeAttributes = [
	'label',
	'placeholder',
	'type',
	'disabled',
	'required',
	'readonly',
	'value',
	'name',
	'id',
];
// Properties that support both kebab-case and camelCase
const dualCaseProps = {
	invalidMessage: 'invalid-message',
	validMessage: 'valid-message',
	dataListId: 'data-list-id',
	showMessage: 'show-message',
	minLength: 'min-length',
	maxLength: 'max-length',
	showLabel: 'show-label',
	showIconLeading: 'show-icon-leading',
	showIcon: 'show-icon',
	iconLeading: 'icon-leading',
	iconTrailing: 'icon-trailing',
	showRequiredAsterisk: 'show-required-asterisk',
	showIconTrailing: 'show-icon-trailing',
	fieldSizing: 'field-sizing',
	readOnly: 'read-only',
	ariaDescribedBy: 'aria-described-by',
	messageSize: 'message-size',
	messageIcon: 'message-icon',
	validMessageSize: 'valid-message-size',
	invalidMessageSize: 'invalid-message-size',
};
---

<div class="component-playground">
	<div class="preview-area">
		{
			config.elementId === 'playground-badge' ? (
				<div class="badge-container">
					<span>List Item</span>
					<Component {...config.defaultProps} id={config.elementId}>
						{config.textElementId && <span id={config.textElementId}>{config.defaultText}</span>}
						{!config.textElementId && config.defaultText}
					</Component>
				</div>
			) : config.elementId === 'playground-input' ? (
				<div class="db-input" id={config.elementId}>
					<label id="playground-input-label">{config.defaultProps.label || 'Label'}</label>
					<input
						id="playground-input-field"
						aria-invalid="false"
						type={config.defaultProps.type || 'text'}
						placeholder={config.defaultProps.placeholder || ''}
						disabled={config.defaultProps.disabled}
					/>
					<span
						id="playground-input-infotext-valid"
						class="db-infotext"
						data-semantic="successful"
						data-size="small"
						data-show-icon-leading="true"
						style="display: none;"
					/>
					<span
						id="playground-input-infotext"
						class="db-infotext"
						data-semantic="critical"
						data-size="small"
						data-show-icon-leading="true"
					/>
					<span data-visually-hidden="true" role="status" />
				</div>
			) : config.elementId === 'playground-switch' ? (
				<label class="db-switch" id={config.elementId}>
					<input
						id="playground-switch-input"
						type="checkbox"
						role="switch"
						checked={config.defaultProps.checked}
						disabled={config.defaultProps.disabled}
						onchange="const controls = document.querySelectorAll('.controls-area input[type=checkbox]'); controls.forEach(c => { if(c.onchange && c.onchange.toString().includes('target.checked')) c.checked = this.checked; });"
					/>
					<span id="playground-switch-label">Enable notifications</span>
				</label>
			) : config.elementId === 'playground-radio' ? (
				<label class="db-radio" id={config.elementId}>
					<input
						id="playground-radio-input"
						type="radio"
						checked={config.defaultProps.checked}
						disabled={config.defaultProps.disabled}
						onchange="const controls = document.querySelectorAll('.controls-area input[type=checkbox]'); controls.forEach(c => { if(c.onchange && c.onchange.toString().includes('target.checked')) c.checked = this.checked; });"
					/>
					<span id="playground-radio-label">Option 1</span>
				</label>
			) : config.elementId === 'playground-checkbox' ? (
				<label class="db-checkbox" id={config.elementId}>
					<input
						id="playground-checkbox-input"
						type="checkbox"
						checked={config.defaultProps.checked}
						disabled={config.defaultProps.disabled}
						onchange="const controls = document.querySelectorAll('.controls-area input[type=checkbox]'); controls.forEach(c => { if(c.onchange && c.onchange.toString().includes('target.checked')) c.checked = this.checked; });"
					/>
					<span id="playground-checkbox-label">Accept terms</span>
				</label>
			) : config.elementId === 'demo-navigation' ? (
				<nav class="db-navigation">
					<menu>
						<li class="db-navigation-item">
							<a href="#" aria-current="page">
								Navigation Item 1
							</a>
						</li>
						<li class="db-navigation-item">
							<a href="#">Navigation Item 2</a>
						</li>
						<li class="db-navigation-item">
							<a href="#">Navigation Item 3</a>
						</li>
					</menu>
				</nav>
			) : config.elementId === 'demo-navigation-item' ? (
				<nav class="db-navigation">
					<menu>
						<li class="db-navigation-item" id={config.elementId} data-width="auto">
							<a id="navigation-item-link" href="#">
								Navigation Item
							</a>
						</li>
					</menu>
				</nav>
			) : config.elementId === 'demo-notification' ? (
				<article
					class="db-notification"
					id={config.elementId}
					data-semantic={config.defaultProps.semantic}
					data-variant={config.defaultProps.variant}
					data-headline={config.defaultProps.headline}
					data-link-variant="block"
				>
					{config.properties.find((p) => p.name === 'show-headline')?.defaultValue !== false && (
						<header id="notification-headline">{config.defaultProps.headline || ''}</header>
					)}
					<p />
					<p id="notification-text">{config.defaultText}</p>
					<p />
					<a
						id="notification-link"
						class="db-link"
						href="#"
						data-variant="inline"
						data-size="medium"
					>
						View details
					</a>
					<button
						id="notification-close"
						class="db-button"
						type="button"
						data-icon="cross"
						data-size="small"
						data-variant="ghost"
						data-no-text="true"
						style={
							config.properties.find((p) => p.name === 'closeable')?.defaultValue === false
								? 'display: none;'
								: ''
						}
					>
						Close
					</button>
				</article>
			) : config.elementId === 'playground-select' ? (
				<div class="db-select" id={config.elementId} data-hide-label="false" data-variant="above">
					<label id="playground-select-label">{config.defaultProps.label || 'Country'}</label>
					<select
						id="playground-select-field"
						aria-invalid="false"
						onchange="const wrapper = document.getElementById('playground-select'); if(wrapper.getAttribute('data-variant') === 'floating') { if(this.value) { wrapper.removeAttribute('data-label-hidden'); } else { wrapper.setAttribute('data-label-hidden', 'true'); } }"
					>
						<option id="playground-select-placeholder" value="" hidden="">
							{config.defaultProps.placeholder || 'Choose an option'}
						</option>
						<option value="de">Germany</option>
						<option value="fr">France</option>
						<option value="it">Italy</option>
						<option value="es">Spain</option>
					</select>
					<span
						id="playground-select-message"
						class="db-infotext"
						data-size="small"
						data-show-icon-leading="true"
						style="display: none;"
					>
						Please choose your country
					</span>
					<span
						id="playground-select-infotext-valid"
						class="db-infotext"
						data-semantic="successful"
						data-size="small"
						data-show-icon-leading="true"
						style="display: none;"
					>
						Valid selection
					</span>
					<span
						id="playground-select-infotext"
						class="db-infotext"
						data-semantic="critical"
						data-size="small"
						data-show-icon-leading="true"
						style="display: none;"
					>
						Please select a valid option
					</span>
					<span data-visually-hidden="true" role="status" />
				</div>
			) : (
				<Component {...config.defaultProps} id={config.elementId}>
					{config.textElementId && <span id={config.textElementId}>{config.defaultText}</span>}
					{!config.textElementId && config.defaultText}
				</Component>
			)
		}
	</div>

	{
		config.properties.filter((prop) => prop.showInPlayground !== false).length > 0 && (
			<div class="controls-area">
				<div class="controls-area-content" data-density="functional">
					{config.properties
						.filter((prop) => prop.showInPlayground !== false)
						.map((prop) => {
							if (prop.type === 'select') {
								const attrName = nativeAttributes.includes(prop.name)
									? prop.name
									: `data-${prop.name}`;
								const targetId =
									config.elementId === 'playground-input' && nativeAttributes.includes(prop.name)
										? prop.name === 'label'
											? 'playground-input-label'
											: 'playground-input-field'
										: config.elementId;
								let updateAction;
								if (config.elementId === 'playground-input' && prop.name === 'label') {
									updateAction = `document.getElementById('${targetId}').textContent = this.value;`;
								} else if (
									(config.elementId === 'playground-input' ||
										config.elementId === 'playground-select') &&
									prop.name === 'validation'
								) {
									const fieldId =
										config.elementId === 'playground-input'
											? 'playground-input-field'
											: 'playground-select-field';
									const validInfoId =
										config.elementId === 'playground-input'
											? 'playground-input-infotext-valid'
											: 'playground-select-infotext-valid';
									const invalidInfoId =
										config.elementId === 'playground-input'
											? 'playground-input-infotext'
											: 'playground-select-infotext';
									updateAction = `const field = document.getElementById('${fieldId}'); const validInfo = document.getElementById('${validInfoId}'); const invalidInfo = document.getElementById('${invalidInfoId}'); if(this.value === 'invalid') { field.setAttribute('aria-invalid', 'true'); field.setAttribute('data-custom-validity', 'invalid'); validInfo.style.display = 'none'; invalidInfo.style.display = ''; } else if(this.value === 'valid') { field.setAttribute('aria-invalid', 'false'); field.setAttribute('data-custom-validity', 'valid'); validInfo.style.display = ''; invalidInfo.style.display = 'none'; } else if(this.value === 'no-validation') { field.setAttribute('aria-invalid', 'false'); field.setAttribute('data-custom-validity', 'no-validation'); validInfo.style.display = 'none'; invalidInfo.style.display = 'none'; }`;
								} else if (config.elementId === 'playground-select' && prop.name === 'variant') {
									updateAction = `const wrapper = document.getElementById('${config.elementId}'); wrapper.setAttribute('data-variant', this.value); const placeholder = document.getElementById('playground-select-placeholder'); if(this.value === 'floating') { placeholder.textContent = ''; } else { const placeholderInput = document.querySelector('.controls-area input[oninput*="playground-select-placeholder"]'); if(placeholderInput) placeholder.textContent = placeholderInput.value; } if(this.value !== 'floating') { wrapper.removeAttribute('data-label-hidden'); }`;
								} else if (config.elementId === 'demo-navigation-item' && prop.name === 'width') {
									updateAction = `document.getElementById('demo-navigation-item').setAttribute('data-width', this.value);`;
								} else {
									updateAction = `document.getElementById('${targetId}').setAttribute('${attrName}', this.value);`;
								}
								return (
									<div class="db-select">
										<label>{prop.label}</label>
										<select onchange={updateAction}>
											{prop.options.map((option) => (
												<option value={option.value} selected={option.default}>
													{option.label}
												</option>
											))}
										</select>
									</div>
								);
							}

							if (prop.type === 'text') {
								const attrName = nativeAttributes.includes(prop.name)
									? prop.name
									: `data-${prop.name}`;
								if (prop.name === 'text') {
									const targetId = config.textElementId || config.elementId;
									if (config.elementId === 'demo-navigation-item') {
										return (
											<div class="db-input">
												<label>{prop.label}</label>
												<input
													type="text"
													value={prop.defaultValue}
													oninput={`document.getElementById('navigation-item-link').textContent = this.value;`}
												/>
											</div>
										);
									}
									return (
										<div class="db-input">
											<label>{prop.label}</label>
											<input
												type="text"
												value={prop.defaultValue}
												oninput={`document.getElementById('${targetId}').textContent = this.value;`}
											/>
										</div>
									);
								} else if (config.elementId === 'playground-switch' && prop.name === 'label') {
									const labelProp = config.properties.find((p) => p.name === 'label');
									return (
										<div class="db-input">
											<label>{prop.label}</label>
											<input
												type="text"
												value={labelProp?.defaultValue || 'Enable notifications'}
												oninput={`document.getElementById('playground-switch-label').textContent = this.value;`}
											/>
										</div>
									);
								} else if (config.elementId === 'playground-radio' && prop.name === 'label') {
									const labelProp = config.properties.find((p) => p.name === 'label');
									return (
										<div class="db-input">
											<label>{prop.label}</label>
											<input
												type="text"
												value={labelProp?.defaultValue || 'Option 1'}
												oninput={`document.getElementById('playground-radio-label').textContent = this.value;`}
											/>
										</div>
									);
								} else if (config.elementId === 'playground-checkbox' && prop.name === 'label') {
									const labelProp = config.properties.find((p) => p.name === 'label');
									return (
										<div class="db-input">
											<label>{prop.label}</label>
											<input
												type="text"
												value={labelProp?.defaultValue || 'Accept terms'}
												oninput={`document.getElementById('playground-checkbox-label').textContent = this.value;`}
											/>
										</div>
									);
								} else if (config.elementId === 'playground-select' && prop.name === 'label') {
									const labelProp = config.properties.find((p) => p.name === 'label');
									return (
										<div class="db-input">
											<label>{prop.label}</label>
											<input
												type="text"
												value={labelProp?.defaultValue || 'Country'}
												oninput={`document.getElementById('playground-select-label').textContent = this.value;`}
											/>
										</div>
									);
								} else if (
									config.elementId === 'playground-select' &&
									prop.name === 'placeholder'
								) {
									const placeholderProp = config.properties.find((p) => p.name === 'placeholder');
									return (
										<div class="db-input">
											<label>{prop.label}</label>
											<input
												type="text"
												value={placeholderProp?.defaultValue || 'Choose an option'}
												oninput={`const placeholder = document.getElementById('playground-select-placeholder'); const wrapper = document.getElementById('playground-select'); if(placeholder && wrapper.getAttribute('data-variant') !== 'floating') placeholder.textContent = this.value;`}
											/>
										</div>
									);
								} else if (
									config.elementId === 'playground-input' &&
									(prop.name === 'validMessage' || prop.name === 'valid-message')
								) {
									return (
										<div class="db-input">
											<label>{prop.label}</label>
											<input
												type="text"
												value={prop.defaultValue}
												oninput={`document.getElementById('playground-input-infotext-valid').textContent = this.value;`}
											/>
										</div>
									);
								} else if (config.elementId === 'playground-select' && prop.name === 'message') {
									return (
										<div class="db-input">
											<label>{prop.label}</label>
											<input
												type="text"
												value={prop.defaultValue}
												oninput={`document.getElementById('playground-select-message').textContent = this.value;`}
											/>
										</div>
									);
								} else if (
									config.elementId === 'playground-select' &&
									(prop.name === 'validMessage' || prop.name === 'valid-message')
								) {
									return (
										<div class="db-input">
											<label>{prop.label}</label>
											<input
												type="text"
												value={prop.defaultValue}
												oninput={`document.getElementById('playground-select-infotext-valid').textContent = this.value;`}
											/>
										</div>
									);
								} else if (
									config.elementId === 'playground-select' &&
									(prop.name === 'invalidMessage' || prop.name === 'invalid-message')
								) {
									return (
										<div class="db-input">
											<label>{prop.label}</label>
											<input
												type="text"
												value={prop.defaultValue}
												oninput={`document.getElementById('playground-select-infotext').textContent = this.value;`}
											/>
										</div>
									);
								} else if (config.elementId === 'demo-navigation-item' && prop.name === 'icon') {
									return (
										<div class="db-input">
											<label>{prop.label}</label>
											<input
												type="text"
												value={prop.defaultValue}
												oninput={`const item = document.getElementById('${config.elementId}'); if(this.value) item.setAttribute('data-icon', this.value); else item.removeAttribute('data-icon');`}
											/>
										</div>
									);
								} else if (config.elementId === 'demo-notification' && prop.name === 'headline') {
									return (
										<div class="db-input">
											<label>{prop.label}</label>
											<input
												type="text"
												value={prop.defaultValue}
												oninput={`const notification = document.getElementById('demo-notification'); notification.setAttribute('data-headline', this.value); const h = document.getElementById('notification-headline'); if(h) h.textContent = this.value;`}
											/>
										</div>
									);
								} else {
									const targetId =
										config.elementId === 'playground-input' && nativeAttributes.includes(prop.name)
											? prop.name === 'label'
												? 'playground-input-label'
												: 'playground-input-field'
											: (config.elementId === 'playground-switch' ||
														config.elementId === 'playground-radio' ||
														config.elementId === 'playground-checkbox') &&
												  (prop.name === 'icon-leading' ||
														prop.name === 'iconLeading' ||
														prop.name === 'icon-trailing' ||
														prop.name === 'iconTrailing')
												? config.elementId
												: config.elementId;
									const updateAction =
										config.elementId === 'playground-input' && prop.name === 'label'
											? `if(this.value) document.getElementById('${targetId}').textContent = this.value; else document.getElementById('${targetId}').textContent = 'Label';`
											: `if(this.value) document.getElementById('${targetId}').setAttribute('${attrName}', this.value); else document.getElementById('${targetId}').removeAttribute('${attrName}');`;
									return (
										<div class="db-input">
											<label>{prop.label}</label>
											<input type="text" value={prop.defaultValue} oninput={updateAction} />
										</div>
									);
								}
							}

							if (prop.type === 'checkbox') {
								let action;
								if (prop.name === 'disabled') {
									const targetId =
										config.elementId === 'playground-input'
											? 'playground-input-field'
											: config.elementId === 'playground-switch' ||
												  config.elementId === 'playground-radio' ||
												  config.elementId === 'playground-checkbox'
												? `${config.elementId}-input`
												: config.elementId;
									if (config.elementId === 'playground-select') {
										action = `const select = document.getElementById('playground-select-field'); if(select) { if(this.checked) select.setAttribute('disabled', ''); else select.removeAttribute('disabled'); }`;
									} else {
										action = config.useAriaDisabled
											? `if(this.checked) document.getElementById('${targetId}').setAttribute('aria-disabled', 'true'); else document.getElementById('${targetId}').removeAttribute('aria-disabled');`
											: `if(this.checked) document.getElementById('${targetId}').setAttribute('${prop.name}', ''); else document.getElementById('${targetId}').removeAttribute('${prop.name}');`;
									}
								} else if (prop.name === 'checked') {
									const targetId =
										config.elementId === 'playground-switch' ||
										config.elementId === 'playground-radio' ||
										config.elementId === 'playground-checkbox'
											? `${config.elementId}-input`
											: config.elementId;
									action = `const target = document.getElementById('${targetId}'); target.checked = this.checked; if(this.checked) target.setAttribute('checked', ''); else target.removeAttribute('checked');`;
								} else if (
									(config.elementId === 'playground-switch' ||
										config.elementId === 'playground-radio' ||
										config.elementId === 'playground-checkbox') &&
									(prop.name === 'show-label' || prop.name === 'showLabel')
								) {
									action = `const label = document.getElementById('${config.elementId}-label'); if(this.checked) label.style.display = ''; else label.style.display = 'none';`;
								} else if (
									config.elementId === 'playground-select' &&
									(prop.name === 'showLabel' || prop.name === 'show-label')
								) {
									action = `const wrapper = document.getElementById('${config.elementId}'); if(wrapper) wrapper.setAttribute('data-hide-label', this.checked ? 'false' : 'true');`;
								} else if (
									config.elementId === 'playground-select' &&
									(prop.name === 'showMessage' || prop.name === 'show-message')
								) {
									action = `const message = document.getElementById('playground-select-message'); if(message) message.style.display = this.checked ? '' : 'none';`;
								} else if (config.elementId === 'playground-select' && prop.name === 'required') {
									action = `const field = document.getElementById('playground-select-field'); if(field) { if(this.checked) field.setAttribute('required', ''); else field.removeAttribute('required'); }`;
								} else if (
									config.elementId === 'playground-checkbox' &&
									prop.name === 'indeterminate'
								) {
									action = `const target = document.getElementById('playground-checkbox-input'); target.indeterminate = this.checked;`;
								} else if (config.elementId === 'demo-notification' && prop.name === 'closeable') {
									action = `const btn = document.getElementById('notification-close'); if(btn) btn.style.display = this.checked ? '' : 'none';`;
								} else if (
									config.elementId === 'demo-navigation-item' &&
									(prop.name === 'show-icon' || prop.name === 'showIcon')
								) {
									action = `const item = document.getElementById('${config.elementId}'); if(this.checked) item.setAttribute('data-show-icon', 'true'); else item.setAttribute('data-show-icon', 'false');`;
								} else if (config.elementId === 'demo-navigation-item' && prop.name === 'active') {
									action = `const item = document.getElementById('${config.elementId}'); if(this.checked) item.setAttribute('data-active', 'true'); else item.removeAttribute('data-active');`;
								} else if (config.elementId === 'demo-navigation-item' && prop.name === 'wrap') {
									action = `const item = document.getElementById('${config.elementId}'); if(this.checked) item.setAttribute('data-wrap', 'true'); else item.removeAttribute('data-wrap');`;
								} else if (
									config.elementId === 'demo-navigation-item' &&
									prop.name === 'disabled'
								) {
									action = `const item = document.getElementById('${config.elementId}'); const link = document.getElementById('navigation-item-link'); if(this.checked) { item.setAttribute('aria-disabled', 'true'); link.setAttribute('aria-disabled', 'true'); } else { item.removeAttribute('aria-disabled'); link.removeAttribute('aria-disabled'); }`;
								} else if (config.elementId === 'demo-notification' && prop.name === 'closeable') {
									action = `const h = document.getElementById('notification-headline'); if(this.checked) { if(!h) { const notification = document.getElementById('demo-notification'); const header = document.createElement('header'); header.id = 'notification-headline'; header.textContent = notification.getAttribute('data-headline') || 'Success'; notification.insertBefore(header, notification.firstChild); } else { h.style.display = ''; } } else { if(h) h.remove(); }`;
								} else {
									action = `if(this.checked) document.getElementById('${config.elementId}').setAttribute('data-${prop.name}', 'true'); else document.getElementById('${config.elementId}').setAttribute('data-${prop.name}', 'false');`;
								}

								return (
									<label class="db-switch">
										<input
											type="checkbox"
											role="switch"
											checked={prop.defaultValue}
											onchange={action}
										/>
										{prop.label}
									</label>
								);
							}
						})}
				</div>
			</div>
		)
	}
</div>
