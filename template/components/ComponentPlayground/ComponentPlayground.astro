---
import './ComponentPlayground.css';

interface Props {
	config: any;
	component: any;
}

const { config, component: Component } = Astro.props;

// Native HTML attributes that should not use data- prefix
const nativeAttributes = ['label', 'placeholder', 'type', 'disabled', 'required', 'readonly', 'value', 'name', 'id'];
// Properties that support both kebab-case and camelCase
const dualCaseProps = {
	'invalidMessage': 'invalid-message',
	'validMessage': 'valid-message',
	'dataListId': 'data-list-id',
	'showMessage': 'show-message',
	'minLength': 'min-length',
	'maxLength': 'max-length',
	'showLabel': 'show-label',
	'showIconLeading': 'show-icon-leading',
	'showIcon': 'show-icon',
	'iconLeading': 'icon-leading',
	'iconTrailing': 'icon-trailing',
	'showRequiredAsterisk': 'show-required-asterisk',
	'showIconTrailing': 'show-icon-trailing',
	'fieldSizing': 'field-sizing',
	'readOnly': 'read-only',
	'ariaDescribedBy': 'aria-described-by',
	'messageSize': 'message-size',
	'messageIcon': 'message-icon',
	'validMessageSize': 'valid-message-size',
	'invalidMessageSize': 'invalid-message-size'
};
---

<div class="component-playground">
	<div class="preview-area">
		{
			config.elementId === 'playground-badge' ? (
				<div class="badge-container">
					<span>List Item</span>
					<Component {...config.defaultProps} id={config.elementId}>
						{config.textElementId && <span id={config.textElementId}>{config.defaultText}</span>}
						{!config.textElementId && config.defaultText}
					</Component>
				</div>
			) : config.elementId === 'playground-input' ? (
				<div class="db-input" id={config.elementId}>
					<label id="playground-input-label">{config.defaultProps.label || 'Label'}</label>
					<input
						id="playground-input-field"
						aria-invalid="false"
						type={config.defaultProps.type || 'text'}
						placeholder={config.defaultProps.placeholder || ''}
						disabled={config.defaultProps.disabled}
					/>
					<span id="playground-input-infotext-valid" class="db-infotext" data-semantic="successful" data-size="small" data-show-icon-leading="true" style="display: none;"></span>
					<span id="playground-input-infotext" class="db-infotext" data-semantic="critical" data-size="small" data-show-icon-leading="true"></span>
					<span data-visually-hidden="true" role="status"></span>
				</div>
			) : config.elementId === 'playground-switch' ? (
				<label class="db-switch" id={config.elementId}>
					<input
						id="playground-switch-input"
						type="checkbox"
						role="switch"
						checked={config.defaultProps.checked}
						disabled={config.defaultProps.disabled}
						onchange="const control = document.querySelector('.controls-area input[type=checkbox][onchange*=checked]'); if(control) control.checked = this.checked;"
					/>
					<span id="playground-switch-label">Enable notifications</span>
				</label>
			) : config.elementId === 'playground-radio' ? (
				<label class="db-radio" id={config.elementId}>
					<input
						id="playground-radio-input"
						type="radio"
						checked={config.defaultProps.checked}
						disabled={config.defaultProps.disabled}
						onchange="const control = document.querySelector('.controls-area input[type=checkbox][onchange*=checked]'); if(control) control.checked = this.checked;"
					/>
					<span id="playground-radio-label">Option 1</span>
				</label>
			) : config.elementId === 'playground-checkbox' ? (
				<label class="db-checkbox" id={config.elementId}>
					<input
						id="playground-checkbox-input"
						type="checkbox"
						checked={config.defaultProps.checked}
						disabled={config.defaultProps.disabled}
						onchange="const control = document.querySelector('.controls-area input[type=checkbox][onchange*=checked]'); if(control) control.checked = this.checked;"
					/>
					<span id="playground-checkbox-label">Accept terms</span>
				</label>
			) : (
				<Component {...config.defaultProps} id={config.elementId}>
					{config.textElementId && <span id={config.textElementId}>{config.defaultText}</span>}
					{!config.textElementId && config.defaultText}
				</Component>
			)
		}
	</div>

	<div class="controls-area">
		<div class="controls-area-content" data-density="functional">
			{
				config.properties
					.filter((prop) => prop.showInPlayground !== false)
					.map((prop) => {
						if (prop.type === 'select') {
							const attrName = nativeAttributes.includes(prop.name) ? prop.name : `data-${prop.name}`;
							const targetId = config.elementId === 'playground-input' && nativeAttributes.includes(prop.name) 
								? (prop.name === 'label' ? 'playground-input-label' : 'playground-input-field')
								: config.elementId;
							let updateAction;
							if (config.elementId === 'playground-input' && prop.name === 'label') {
								updateAction = `document.getElementById('${targetId}').textContent = this.value;`;
							} else if (config.elementId === 'playground-input' && prop.name === 'validation') {
								updateAction = `const field = document.getElementById('playground-input-field'); const validInfo = document.getElementById('playground-input-infotext-valid'); const invalidInfo = document.getElementById('playground-input-infotext'); if(this.value === 'invalid') { field.setAttribute('aria-invalid', 'true'); field.setAttribute('data-custom-validity', 'invalid'); validInfo.style.display = 'none'; invalidInfo.style.display = ''; } else if(this.value === 'valid') { field.setAttribute('aria-invalid', 'false'); field.setAttribute('data-custom-validity', 'valid'); validInfo.style.display = ''; invalidInfo.style.display = 'none'; } else if(this.value === 'no-validation') { field.setAttribute('aria-invalid', 'false'); field.setAttribute('data-custom-validity', 'no-validation'); validInfo.style.display = 'none'; invalidInfo.style.display = 'none'; }`;
							} else {
								updateAction = `document.getElementById('${targetId}').setAttribute('${attrName}', this.value);`;
							}
							return (
								<div class="db-select">
									<label>{prop.label}</label>
									<select onchange={updateAction}>
										{prop.options.map((option) => (
											<option value={option.value} selected={option.default}>
												{option.label}
											</option>
										))}
									</select>
								</div>
							);
						}

						if (prop.type === 'text') {
							const attrName = nativeAttributes.includes(prop.name) ? prop.name : `data-${prop.name}`;
							if (prop.name === 'text') {
								return (
									<div class="db-input">
										<label>{prop.label}</label>
										<input
											type="text"
											value={prop.defaultValue}
											oninput={`document.getElementById('${config.textElementId}').textContent = this.value;`}
										/>
									</div>
								);
							} else if (config.elementId === 'playground-switch' && prop.name === 'label') {
								const labelProp = config.properties.find(p => p.name === 'label');
								return (
									<div class="db-input">
										<label>{prop.label}</label>
										<input
											type="text"
											value={labelProp?.defaultValue || 'Enable notifications'}
											oninput={`document.getElementById('playground-switch-label').textContent = this.value;`}
										/>
									</div>
								);
							} else if (config.elementId === 'playground-radio' && prop.name === 'label') {
								const labelProp = config.properties.find(p => p.name === 'label');
								return (
									<div class="db-input">
										<label>{prop.label}</label>
										<input
											type="text"
											value={labelProp?.defaultValue || 'Option 1'}
											oninput={`document.getElementById('playground-radio-label').textContent = this.value;`}
										/>
									</div>
								);
							} else if (config.elementId === 'playground-checkbox' && prop.name === 'label') {
								const labelProp = config.properties.find(p => p.name === 'label');
								return (
									<div class="db-input">
										<label>{prop.label}</label>
										<input
											type="text"
											value={labelProp?.defaultValue || 'Accept terms'}
											oninput={`document.getElementById('playground-checkbox-label').textContent = this.value;`}
										/>
									</div>
								);
							} else if (config.elementId === 'playground-input' && (prop.name === 'validMessage' || prop.name === 'valid-message')) {
								return (
									<div class="db-input">
										<label>{prop.label}</label>
										<input
											type="text"
											value={prop.defaultValue}
											oninput={`document.getElementById('playground-input-infotext-valid').textContent = this.value;`}
										/>
									</div>
								);
							} else if (config.elementId === 'playground-input' && (prop.name === 'invalidMessage' || prop.name === 'invalid-message')) {
								return (
									<div class="db-input">
										<label>{prop.label}</label>
										<input
											type="text"
											value={prop.defaultValue}
											oninput={`document.getElementById('playground-input-infotext').textContent = this.value;`}
										/>
									</div>
								);
							} else {
								const targetId = config.elementId === 'playground-input' && nativeAttributes.includes(prop.name)
									? (prop.name === 'label' ? 'playground-input-label' : 'playground-input-field')
									: (config.elementId === 'playground-switch' || config.elementId === 'playground-radio' || config.elementId === 'playground-checkbox') && (prop.name === 'icon-leading' || prop.name === 'iconLeading' || prop.name === 'icon-trailing' || prop.name === 'iconTrailing')
									? config.elementId
									: config.elementId;
								const updateAction = config.elementId === 'playground-input' && prop.name === 'label'
									? `if(this.value) document.getElementById('${targetId}').textContent = this.value; else document.getElementById('${targetId}').textContent = 'Label';`
									: `if(this.value) document.getElementById('${targetId}').setAttribute('${attrName}', this.value); else document.getElementById('${targetId}').removeAttribute('${attrName}');`;
								return (
									<div class="db-input">
										<label>{prop.label}</label>
										<input
											type="text"
											value={prop.defaultValue}
											oninput={updateAction}
										/>
									</div>
								);
							}
						}

						if (prop.type === 'checkbox') {
							let action;
							if (prop.name === 'disabled') {
								const targetId = config.elementId === 'playground-input' ? 'playground-input-field' : (config.elementId === 'playground-switch' || config.elementId === 'playground-radio' || config.elementId === 'playground-checkbox') ? `${config.elementId}-input` : config.elementId;
								action = config.useAriaDisabled
									? `if(this.checked) document.getElementById('${targetId}').setAttribute('aria-disabled', 'true'); else document.getElementById('${targetId}').removeAttribute('aria-disabled');`
									: `if(this.checked) document.getElementById('${targetId}').setAttribute('${prop.name}', ''); else document.getElementById('${targetId}').removeAttribute('${prop.name}');`;
							} else if (prop.name === 'checked') {
								const targetId = (config.elementId === 'playground-switch' || config.elementId === 'playground-radio' || config.elementId === 'playground-checkbox') ? `${config.elementId}-input` : config.elementId;
								action = `const target = document.getElementById('${targetId}'); target.checked = this.checked; if(this.checked) target.setAttribute('checked', ''); else target.removeAttribute('checked');`;
							} else if ((config.elementId === 'playground-switch' || config.elementId === 'playground-radio' || config.elementId === 'playground-checkbox') && (prop.name === 'show-label' || prop.name === 'showLabel')) {
								action = `const label = document.getElementById('${config.elementId}-label'); if(this.checked) label.style.display = ''; else label.style.display = 'none';`;
							} else if (config.elementId === 'playground-checkbox' && prop.name === 'indeterminate') {
								action = `const target = document.getElementById('playground-checkbox-input'); target.indeterminate = this.checked;`;
							} else {
								action = `if(this.checked) document.getElementById('${config.elementId}').setAttribute('data-${prop.name}', 'true'); else document.getElementById('${config.elementId}').setAttribute('data-${prop.name}', 'false');`;
							}

							return (
								<label class="db-switch">
									<input type="checkbox" role="switch" checked={prop.defaultValue} onchange={action} />
									{prop.label}
								</label>
							);
						}
					})
			}
		</div>
	</div>
</div>
